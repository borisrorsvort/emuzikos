- title t(:'.title', :username => @user.username)

- if @user.profile_completed?
  - description "#{ @user.username}" + ": " + "#{"Local " + t(:"users.types.#{@user.user_type}")} looking for #{@user.searching_for if @user.searching_for} in #{Carmen::country_name(@user.country) rescue "N/A"} "
- else
  - description t(:'.title', :username => @user.username) + " - Emuzikos"

- set_meta_tags :canonical => request.url


- content_for :scripts do
  :javascript
    $( "#tabs" ).tabs({
      select: function(event, ui) { window.location.hash = ui.tab.hash; }
    });


- content_for :sub_nav do
  - if @user == current_user
    %ul#sub_sections
      %li
        = link_to t(:'menu.profile.edit'), edit_user_path(current_user)
      %li
        = link_to t(:'menu.profile.public'),  user_path(current_user), :class => "current"
      %li
        = link_to t(:'menu.profile.account'), edit_user_registration_path(current_user)
      %li
        = link_to t(:'menu.profile.authentications'), services_path
    .clear

  - else
    #actions_set
      = link_to t(:'buttons.back', :model => t(:'activerecord.models.search')), :back, :class => "button back profile"
  .clear

%section.right_drawer.profile
  .inner_profile_wrapper
    %header
      %h1.username= t(:'.title', :username => @user.username)

      %span.location_infos
        - if @user.user_type.present?
          =t(:"users.types.#{@user.user_type}")
        - if @user.geocoded?
          =t(:'.from')
          = @user.zip
          = Carmen::country_name(@user.country) rescue "N/A"

    -if current_user && current_user != @user
      .friendly_actions
        = link_to t(:'buttons.contact'), new_user_message_path(@current_user, :to => @user.id), :class => "button contact"
        - unless current_user.is_friend_with(@user)
          = link_to t(:'buttons.add_to_contact_list'), friendships_path(:friend_id => @user.id), :method => :post, :class => "button add_to_contact_list"
    -if !current_user
      .friendly_actions
        = link_to t(:'buttons.contact'), new_user_registration_path, :class => "button contact tooltip", :title => t(:'tooltips.send_message_not_signed_in')
    .impressionist_count
      = t(:'.impressions_count', :count => @user.impressionist_count(:filter=>:ip_address))
    .spread
      = render "shared/add_this"
      .clear
    #tabs
      %ul.profile_tabs_nav
        %li
          %a{:href => "#tab_info", :class => "icon-info"}= t(:'.tabs.user_infos')
        - unless @events.results.empty?
          %li
            %a{:href => "#tab_events", :class => "icon-calendar"}= t(:'.tabs.user_events')
        - if @user.youtube_video_id? || @tracks.present?
          %li
            %a{:href => "#tab_medias", :class => "icon-video"}= t(:'.tabs.user_medias')

      / INFOS TAB START
      #tab_info
        - if @user.searching_for.present?
          %h3= t(:'activerecord.attributes.user.searching_for') + " :"
          %p= t(:"users.types.#{@user.searching_for}")

        - if @user.genres.present?
          %h3= t(:'activerecord.attributes.user.genre')
          .tag_list_instruments
            - @user.genres.each do |genre|
              .tag-body.yellow
                %span.tag= t(:"musical_genres.#{genre.name}")

        - if @user.instruments.present?
          %h3= t(:'activerecord.attributes.user.instruments')
          .tag_list_instruments
            - @user.instruments.each do |instrument|
              .tag-body.yellow
                %span.tag= t(:"instruments.#{instrument.name}")

        - if @user.references.present?
          %h3= t(:'activerecord.attributes.user.references')
          %p= @user.references

        - if @user.request_message.present?
          %h3= t(:'activerecord.attributes.user.request_message')
          = simple_format(@user.request_message)

          .clear

        - if @user.geocoded?
          - unless @users_nearby.size.nil?
            .users_nearby
              %h3= t(:'.users_nearby')
              - for user in @users_nearby
                .section.user_general_infos
                  .avatar.small
                    - if user.avatar.present?
                      = link_to(image_tag(user.avatar.url(:gallery), :alt => "#{user.username + "'s picture"}"), user_path(user), :class => "tooltip", :title => "#{user.username}")
                    -else
                      = link_to(image_tag("backgrounds/avatar-default.gif", :alt => "#{user.username + "'s picture"}"), user_path(user), :class => "tooltip", :title => "#{user.username}")
                    .clear
              .clear

      - unless @events.results.empty?
        / EVENTS TAB START
        #tab_events
          .future_events
            %h3= t(:'.events')
            %ul
              - @events.results.first(5).each do |event|
                %li
                  = event.start.to_date
                  = " | "
                  = event.venue.display_name
                  = " | "
                  = link_to t(:'common.read_more'), event.uri, :target => "_blank"
            = image_tag "songkick/concerts_by_songkick.gif", :alt => "Concerts by Songkick"
          .clear

      - if @user.youtube_video_id? || @tracks.present?
        / MEDIA TAB START
        #tab_medias
          - if @tracks.present?
            %h3= t(:souncloud_player)
            - for track in @tracks do
              %iframe{:frameborder => "no", :height => "166", :scrolling => "no", :src => "http://w.soundcloud.com/player/?url=http%3A%2F%2Fapi.soundcloud.com%2Ftracks%2F#{track.id}&show_artwork=true", :width => "100%"}

          - if @user.youtube_video_id?
            %h3= t(:'.youtube_video')
            %section
              %iframe{:src => "http://www.youtube.com/embed/#{@user.youtube_video_id}", :width => "320", :height => "190"}
          .clear

%section.left_drawer.fadeInLeft
  .inner
    - if @user.avatar
      = image_tag @user.avatar.url(:normal), :class => "profile_picture", :alt => "#{@user.username + "'s picture"}"
    - else
      = image_tag "backgrounds/avatar-default-profile.gif", :class => "profile_picture", :alt => "#{@user.username + "'s picture"}"
    - if @user.geocoded?
      %img{:src => "http://maps.googleapis.com/maps/api/staticmap?center=#{@user.latitude},#{@user.longitude}&zoom=11&sensor=false&markers=#{@user.latitude},#{@user.longitude}&size=400x400", :class => "map_container", :alt => "#{@user.username}'s location"}
.clear
